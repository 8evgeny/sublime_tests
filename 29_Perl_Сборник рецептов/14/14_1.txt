Пример 14.1. userstats
#!/usr/bin/perl -w
# userstats - вывод статистики о зарегистрированных пользователях.
# При вызове с аргументом выводит данные по конкретным пользователям.

use DB_File;

$db = "/tmp/userstats.db";     # База для хранения данных между запусками

tie(%db, ’DB_File’, $db)       or die "Can't open DB_File $db : $!\n";

if (@ARGV) {
    if ("@ARGV" eq "ALL") {
        @ARGV = sort keys %db;
    }
    foreach $user (@ARGV) {
            print "$user\t$db{$user}\n";
    }
} else {
    @who = `who`;                             # Запустить who(1)
    if ($?) {
        die "Couldn’t run who: $?\n";         # Аварийное завершение
    }
    # Извлечь имя пользователя (первое в строке) и обновить
    foreach $line (@who) {
        $line =~ /^(\S+)/;
        die "Bad line from who: $line\n" unless $1;
        $db{$1}++;
    }
}

untie %db;

